# values-probe.yaml
# Configuration for running NTP Exporter in probe mode (Deployment)
# Use: helm install ntp-exporter . -f values-probe.yaml

mode: probe

# Number of replicas for redundancy
replicaCount: 2

# Standard resources for Deployment
resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 50m
    memory: 64Mi

# Use cluster network
hostNetwork: false
dnsPolicy: ClusterFirst

# Deployment strategy
deploymentStrategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# Pod anti-affinity for high availability
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - ntp-exporter
        topologyKey: kubernetes.io/hostname

# Enable ServiceMonitor
serviceMonitor:
  enabled: true
  interval: 60s
  scrapeTimeout: 30s
  additionalLabels:
    prometheus: kube-prometheus

# Network policy
networkPolicy:
  enabled: true
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    ports:
    - protocol: TCP
      port: 9559
  egress:
  - to:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          k8s-app: kube-dns
    ports:
    - protocol: UDP
      port: 53
  - to:
    - namespaceSelector: {}
    ports:
    - protocol: UDP
      port: 123
    - protocol: TCP
      port: 443

# NTP configuration optimized for probe mode
config:
  ntpServers:
  - time.google.com
  - time.cloudflare.com
  - time.apple.com
  metricsPort: 9559
  scrapeInterval: 60s
  ntpTimeout: 15s
  maxClockOffset: 100ms
  logging:
    level: info
    format: json

# Higher priority for centralized probes
priorityClassName: ""
